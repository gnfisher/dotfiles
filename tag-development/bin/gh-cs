#!/bin/sh

codespace="$1"

sudo gh cs ports forward 80:80 -c "$codespace" &
pid=$!
rdm server &

gh cs ssh -c "$codespace" -- -R 128.0.0.1:7391:$(rdm socket)
cspid=$!

cleanup() {
  sudo kill -s TERM "$pid"
  sudo kill -s TERM "$cspid"
  rdm stop
  echo "Done."
}

trap cleanup EXIT SIGINT SIGTERM

